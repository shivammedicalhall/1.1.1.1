<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shivam Medical Hall - Inventory Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Poppins font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Pikaday CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
    <style>
        :root {
            --bg-color: #e3f2fd;
            --bg-gradient-1: #e3f2fd;
            --bg-gradient-2: #b3e5fc;
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            --table-bg: #ffffff;
            --table-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
            --header-bg: linear-gradient(90deg, #007bff, #00d4ff);
            --header-text: #ffffff;
            --btn-primary-bg: linear-gradient(90deg, #007bff, #00d4ff);
            --btn-primary-hover: linear-gradient(90deg, #0056b3, #0096cc);
            --btn-success-bg: linear-gradient(90deg, #28a745, #34c759);
            --btn-success-hover: linear-gradient(90deg, #1e7e34, #2ba84a);
            --btn-danger-bg: linear-gradient(90deg, #dc3545, #ff4d4d);
            --btn-danger-hover: linear-gradient(90deg, #c82333, #e52d2d);
            --time-bg: rgba(0, 123, 255, 0.95);
            --time-text: #ffffff;
            --footer-bg: rgba(0, 0, 0, 0.1);
            --footer-text: #333;
            --input-bg: rgba(255, 255, 255, 0.8);
            --input-border: #ced4da;
            --input-focus-border: #007bff;
            --input-shadow: 0 0 15px rgba(0, 123, 255, 0.5);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --bg-gradient-1: #1a1a1a;
            --bg-gradient-2: #2a2a2a;
            --text-color: #f0f0f0;
            --card-bg: rgba(30, 30, 30, 0.95);
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            --table-bg: #2e2e2e;
            --table-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
            --header-bg: linear-gradient(90deg, #0056b3, #0096cc);
            --header-text: #e0e0e0;
            --btn-primary-bg: linear-gradient(90deg, #0056b3, #0096cc);
            --btn-primary-hover: linear-gradient(90deg, #003d82, #0077a3);
            --btn-success-bg: linear-gradient(90deg, #1e7e34, #2ba84a);
            --btn-success-hover: linear-gradient(90deg, #145823, #218739);
            --btn-danger-bg: linear-gradient(90deg, #c82333, #e52d2d);
            --btn-danger-hover: linear-gradient(90deg, #a11929, #cc1a1a);
            --time-bg: rgba(0, 77, 153, 0.95);
            --time-text: #e0e0e0;
            --footer-bg: rgba(40, 40, 40, 0.5);
            --footer-text: #d0d0d0;
            --input-bg: rgba(40, 40, 40, 0.8);
            --input-border: #4a4a4a;
            --input-focus-border: #66b0ff;
            --input-shadow: 0 0 15px rgba(0, 77, 153, 0.5);
        }

        body {
            background-image: url('background.png'), url('https://www.transparenttextures.com/patterns/medical-wallpaper.png'), linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 100%);
            background-size: cover, auto, auto;
            background-attachment: fixed, fixed, fixed;
            background-blend-mode: overlay;
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            padding-bottom: 60px;
            margin: 0;
            transition: all 0.3s ease;
        }
        .expired-row {
            background-color: rgba(255, 230, 230, 0.9) !important;
            border: 2px solid var(--btn-danger-bg) !important;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        .form-container {
            max-width: 100%;
            margin: 15px auto;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            padding: 15px;
            backdrop-filter: blur(5px);
            transition: transform 0.3s ease;
        }
        .form-container:hover {
            transform: translateY(-5px);
        }
        table {
            width: 100%;
            margin-top: 15px;
            background: var(--table-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--table-shadow);
        }
        th, td {
            text-align: center;
            padding: 10px;
            font-size: 14px;
            color: var(--text-color);
        }
        th {
            background: var(--header-bg);
            color: var(--header-text);
            font-weight: 600;
        }
        .login-container {
            max-width: 100%;
            margin: 20px auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            backdrop-filter: blur(5px);
            animation: heartbeat 2s infinite;
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            10% { transform: scale(1.05); }
            20% { transform: scale(1); }
            30% { transform: scale(1.05); }
            40% { transform: scale(1); }
            100% { transform: scale(1); }
        }
        .login-container h3 {
            color: var(--btn-primary-bg);
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 24px;
        }
        .login-container .form-control {
            border-radius: 30px;
            padding-left: 40px;
            border: 1px solid var(--input-border);
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 14px;
        }
        .login-container .form-control:focus {
            border-color: var(--input-focus-border);
            box-shadow: var(--input-shadow);
        }
        .login-container .input-group-text {
            border: none;
            background: transparent;
            position: absolute;
            z-index: 3;
            top: 50%;
            transform: translateY(-50%);
            left: 10px;
            color: var(--btn-primary-bg);
        }
        .login-container .btn-primary {
            border-radius: 30px;
            padding: 10px;
            font-weight: 600;
            background: var(--btn-primary-bg);
            border: none;
            transition: all 0.3s ease;
            font-size: 16px;
            color: var(--header-text);
        }
        .login-container .btn-primary:hover {
            background: var(--btn-primary-hover);
            transform: translateY(-2px);
        }
        .search-container {
            max-width: 100%;
            margin: 15px auto;
            flex-wrap: wrap;
            position: relative;
        }
        .search-container .clear-btn {
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--btn-danger-bg);
            font-size: 18px;
            cursor: pointer;
            padding: 0 5px;
            z-index: 1;
        }
        .search-container .clear-btn:hover {
            color: var(--btn-danger-hover);
        }
        .btn-primary, .btn-success, .btn-secondary, .btn-danger {
            border-radius: 25px;
            padding: 8px 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--header-text);
        }
        .btn-primary {
            background: var(--btn-primary-bg);
            border: none;
        }
        .btn-primary:hover {
            background: var(--btn-primary-hover);
        }
        .btn-success {
            background: var(--btn-success-bg);
        }
        .btn-success:hover {
            background: var(--btn-success-hover);
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-danger {
            background: var(--btn-danger-bg);
        }
        .btn-danger:hover {
            background: var(--btn-danger-hover);
        }
        .time-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--time-bg);
            color: var(--time-text);
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            font-weight: 500;
            animation: glow 3s infinite;
            z-index: 1000;
        }
        @keyframes glow {
            0% { box-shadow: 0 5px 20px rgba(0, 123, 255, 0.5); }
            50% { box-shadow: 0 5px 30px rgba(0, 123, 255, 0.8); }
            100% { box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5); }
        }
        .header-title {
            color: var(--btn-primary-bg);
            font-weight: 700;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
            font-size: 28px;
        }
        .logo {
            display: block;
            margin: 0 auto 15px;
            max-width: 100px;
        }
        .modal-content {
            border-radius: 15px;
            background: var(--card-bg);
            backdrop-filter: blur(5px);
        }
        .modal-header {
            background: var(--header-bg);
            color: var(--header-text);
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        .modal-title {
            font-weight: 600;
            font-size: 18px;
            color: var(--header-text);
        }
        .modal-body table {
            margin-top: 0;
            box-shadow: none;
        }
        .notification-box {
            max-width: 100%;
            margin: 15px auto;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            padding: 15px;
            backdrop-filter: blur(5px);
            display: block;
            position: relative;
            top: 0;
            overflow: hidden;
        }
        .notification-box .header {
            display: none;
        }
        .notification-box marquee {
            width: 100%;
            min-width: 300px;
            color: var(--btn-danger-bg);
            font-weight: 600;
            white-space: nowrap;
            padding: 5px 0;
            overflow-x: auto;
        }
        .footer {
            text-align: center;
            padding: 10px 0;
            background: var(--footer-bg);
            color: var(--footer-text);
            font-size: 12px;
            width: 100%;
            position: relative;
            bottom: 0;
            clear: both;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6) !important;
        }
        .hamburger-menu {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 2000;
            cursor: pointer;
            display: none;
        }
        .hamburger-menu .bar {
            width: 25px;
            height: 3px;
            background-color: var(--btn-primary-bg);
            margin: 6px 0;
            transition: 0.4s;
        }
        .menu-content {
            display: none;
            position: fixed;
            top: 50px;
            left: 15px;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 10px;
            z-index: 2000;
        }
        .menu-content button {
            display: block;
            width: 100%;
            margin: 5px 0;
            border-radius: 20px;
            border: none;
            background: var(--btn-primary-bg);
            color: var(--header-text);
            padding: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .menu-content button:hover {
            background: var(--btn-primary-hover);
        }
        .wanting-section {
            max-width: 100%;
            margin: 15px auto;
        }
        .wanting-table {
            margin-top: 15px;
            background: var(--table-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--table-shadow);
        }
        .vanish {
            animation: vanishAnimation 0.5s ease-out forwards;
        }
        @keyframes vanishAnimation {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        @media (max-width: 767px) {
            th, td { font-size: 12px; padding: 8px; }
            .form-container { padding: 10px; }
            .login-container h3 { font-size: 20px; }
            .login-container .btn-primary { font-size: 14px; padding: 8px; }
            .btn-primary, .btn-success, .btn-secondary, .btn-danger { font-size: 12px; padding: 6px 12px; }
            .time-display { font-size: 12px; padding: 8px 12px; top: 5px; right: 5px; }
            .header-title { font-size: 22px; }
            .logo { max-width: 80px; }
            .modal-title { font-size: 16px; }
            .notification-box marquee { font-size: 12px; }
            .footer { font-size: 10px; }
            .hamburger-menu .bar { width: 20px; }
            .menu-content button { font-size: 12px; padding: 6px; }
        }
    </style>
</head>
<body>
    <script>
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
        if (isMobile) {
            document.body.innerHTML = '<div class="restricted-message">Access restricted to desktops and laptops only. No Mobiles will allowed!!!</div>';
        }
    </script>

    <!-- Login Section -->
    <div class="login-container" id="loginSection">
        <img src="logo.png" alt="Shivam Medical Hall Logo" class="logo">
        <h3><i class="fas fa-clinic-medical me-2"></i>Shivam Medical Hall</h3>
        <form id="loginForm">
            <div class="mb-3 position-relative">
                <label for="username" class="form-label">Username</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input type="text" class="form-control ps-5" id="username" placeholder="Enter Username" required>
                </div>
            </div>
            <div class="mb-3 position-relative">
                <label for="password" class="form-label">Password</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    <input type="password" class="form-control ps-5" id="password" placeholder="Enter Password" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-sign-in-alt me-2"></i>Login</button>
            <p id="loginError" class="text-danger mt-3 text-center" style="display: none;">Invalid credentials or access restricted.</p>
        </form>
        <div class="footer">
            ©2025,Shivam Medical Hall,All Rights Reserved.
        </div>
    </div>

    <!-- Main Content -->
    <div class="container" id="mainContent" style="display: none;">
        <div class="hamburger-menu" id="hamburgerMenu" onclick="toggleMenu()">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
        <div class="menu-content" id="menuContent">
            <!-- Hamburger menu remains empty -->
        </div>

        <div class="time-display" id="timeDisplay">Kolkata Time: Loading...</div>
        <div class="text-center my-3">
            <h1 class="header-title d-inline-block me-3"><i class="fas fa-clinic-medical me-2"></i>Shivam Medical Hall - Inventory Management</h1>
            <button id="themeToggle" class="btn btn-secondary" onclick="toggleTheme()">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
        </div>

        <div class="notification-box" id="notificationBox">
            <marquee id="notificationMarquee" behavior="scroll" direction="left" scrollamount="5"></marquee>
        </div>

        <div class="search-container d-flex">
            <div class="input-group w-100">
                <input type="text" class="form-control me-2" id="searchInput" placeholder="Search by Product Name or Batch No.">
                <button class="btn btn-secondary" id="searchButton" onclick="searchMedicines()"><i class="fas fa-search me-2"></i>Search</button>
                <button type="button" class="clear-btn" id="clearSearch" style="display: none;"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <div class="form-container" id="addMedicineSection">
            <h3><i class="fas fa-plus me-2"></i>Add New Medicine</h3>
            <form id="medicineForm">
                <div class="row g-2">
                    <div class="col-md-4 mb-3">
                        <label for="productName" class="form-label">Product Name</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="quantity" min="1" required>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="mrp" class="form-label">MRP (₹)</label>
                        <input type="number" step="0.01" class="form-control" id="mrp" min="0" required>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="batchNo" class="form-label">Batch No.</label>
                        <input type="text" class="form-control" id="batchNo" required>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="expDate" class="form-label">Exp. Date (MM-YYYY)</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="expDate" placeholder="MM-YYYY" required>
                            <button type="button" class="btn btn-outline-secondary" id="expDatePickerBtn"><i class="fas fa-calendar-alt"></i></button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100"><i class="fas fa-plus me-2"></i>Add Medicine</button>
            </form>
        </div>

        <div class="form-container">
            <h3><i class="fas fa-table me-2"></i>Medicine Inventory</h3>
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>MRP (₹)</th>
                        <th>Batch No.</th>
                        <th>Exp. Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="medicineTable"></tbody>
            </table>
        </div>

        <div class="wanting-section" id="wantingSection">
            <div class="form-container">
                <h3><i class="fas fa-shopping-cart me-2"></i>Wanting List</h3>
                <table class="wanting-table table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Medicine Name</th>
                            <th>Qty</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="wantingTable"></tbody>
                </table>
            </div>
        </div>

        <div class="text-center my-3">
            <button class="btn btn-success me-2" onclick="generatePDF(false)"><i class="fas fa-file-pdf me-2"></i>Download Expiry Report (PDF)</button>
            <button class="btn btn-info me-2" onclick="exportData()"><i class="fas fa-download me-2"></i>Export Data</button>
            <input type="file" id="importFile" accept=".json" class="d-none" onchange="importData(event)">
            <button class="btn btn-info me-2" onclick="document.getElementById('importFile').click()"><i class="fas fa-upload me-2"></i>Import Data</button>
            <button class="btn btn-danger me-2" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Logout</button>
            <button class="btn btn-success" onclick="showAddWantingModal()"><i class="fas fa-sticky-note me-2"></i>Wanting</button>
        </div>

        <div class="footer">
            © Copyright 2025, Shivam Medical Hall, All Rights Reserved.
        </div>
    </div>

    <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel"><i class="fas fa-search me-2"></i>Search Results</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th>Product Name</th>
                                <th>Quantity</th>
                                <th>MRP (₹)</th>
                                <th>Batch No.</th>
                                <th>Exp. Date</th>
                            </tr>
                        </thead>
                        <tbody id="searchResults"></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-times me-2"></i>Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel"><i class="fas fa-edit me-2"></i>Edit Medicine</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editIndex">
                        <div class="mb-3">
                            <label for="editProductName" class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="editProductName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editQuantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="editQuantity" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMrp" class="form-label">MRP (₹)</label>
                            <input type="number" step="0.01" class="form-control" id="editMrp" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="editBatchNo" class="form-label">Batch No.</label>
                            <input type="text" class="form-control" id="editBatchNo" required>
                        </div>
                        <div class="mb-3">
                            <label for="editExpDate" class="form-label">Exp. Date (MM-YYYY)</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="editExpDate" placeholder="MM-YYYY" required>
                                <button type="button" class="btn btn-outline-secondary" id="editExpDatePickerBtn"><i class="fas fa-calendar-alt"></i></button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save me-2"></i>Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editWantingModal" tabindex="-1" aria-labelledby="editWantingModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editWantingModalLabel"><i class="fas fa-edit me-2"></i>Edit Wanting</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editWantingForm">
                        <input type="hidden" id="editWantingIndex">
                        <div class="mb-3">
                            <label for="editWantingName" class="form-label">Medicine Name</label>
                            <input type="text" class="form-control" id="editWantingName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editWantingQty" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="editWantingQty" min="1" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save me-2"></i>Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addWantingModal" tabindex="-1" aria-labelledby="addWantingModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addWantingModalLabel"><i class="fas fa-plus me-2"></i>Add Medicine for Wanting</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addWantingForm">
                        <div class="mb-3">
                            <label for="newWantingName" class="form-label">Medicine Name</label>
                            <input type="text" class="form-control" id="newWantingName" required>
                        </div>
                        <div class="mb-3">
                            <label for="newWantingQty" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="newWantingQty" min="1" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="fas fa-plus me-2"></i>Add Medicine for Wanting</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <audio id="alertSound" src="alert.mp3" preload="auto"></audio>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
    <script>
        const { jsPDF } = window.jspdf;
        let medicines = [];
        let inMemoryMedicines = [];
        let wantingList = [];
        let inMemoryWanting = [];

        function loadData() {
            try {
                const storedMedicines = localStorage.getItem('medicines');
                medicines = storedMedicines ? JSON.parse(storedMedicines) : [];
                inMemoryMedicines = [...medicines];
                const storedWanting = localStorage.getItem('wantingList');
                wantingList = storedWanting ? JSON.parse(storedWanting) : [];
                inMemoryWanting = [...wantingList];
            } catch (e) {
                console.error('Error loading data from localStorage:', e);
                medicines = [...inMemoryMedicines];
                wantingList = [...inMemoryWanting];
            }
        }

        let isLoggedIn = false;
        let searchTimeout = null;
        let audioPlayed = false;

        function updateTimeDisplay() {
            const options = { timeZone: 'Asia/Kolkata', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true, weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeDisplay = document.getElementById('timeDisplay');
            if (timeDisplay) timeDisplay.textContent = `Kolkata Time: ${new Date().toLocaleString('en-US', options)}`;
        }
        setInterval(updateTimeDisplay, 1000);
        updateTimeDisplay();

        function logout() {
            if (isLoggedIn && confirm('Are you sure you want to logout?')) {
                isLoggedIn = false;
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('loginSection').style.display = 'block';
                saveData();
                const hamburgerMenu = document.getElementById('hamburgerMenu');
                if (hamburgerMenu) hamburgerMenu.style.display = 'none';
            }
        }

        function toggleMenu() {
            const menuContent = document.getElementById('menuContent');
            if (menuContent) menuContent.style.display = menuContent.style.display === 'block' ? 'none' : 'block';
        }

        function showWantingSection() {
            const wantingSection = document.getElementById('wantingSection');
            if (wantingSection && isLoggedIn) {
                wantingSection.style.display = 'block';
                displayWanting();
            }
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
            localStorage.setItem('theme', newTheme);
        }

        function showAddWantingModal() {
            if (!isLoggedIn) return;
            document.getElementById('newWantingName').value = '';
            document.getElementById('newWantingQty').value = '';
            const addWantingModal = new bootstrap.Modal(document.getElementById('addWantingModal'));
            if (addWantingModal) addWantingModal.show();
        }

        document.getElementById('loginForm')?.addEventListener('submit', function (e) {
            e.preventDefault();
            const username = document.getElementById('username')?.value.trim() || '';
            const password = document.getElementById('password')?.value.trim() || '';
            const loginError = document.getElementById('loginError');

            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
            if (isMobile) {
                alert('Access restricted to desktops and laptops only. No Mobiles will allowed!!!');
                return;
            }

            if (loginError) {
                if (username === 'admin' && password === 'admin123') {
                    isLoggedIn = true;
                    document.getElementById('loginSection').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                    const hamburgerMenu = document.getElementById('hamburgerMenu');
                    if (hamburgerMenu) hamburgerMenu.style.display = 'block';
                    loadData();
                    displayMedicines();
                    updateNotificationMarquee();
                    showExpiryAlert();
                    initializeSearch();
                    initializeDatePickers();
                    const savedTheme = localStorage.getItem('theme');
                    if (savedTheme) {
                        document.body.setAttribute('data-theme', savedTheme);
                        const themeIcon = document.getElementById('themeIcon');
                        if (themeIcon) themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                    }
                    loginError.style.display = 'none';
                    this.reset();
                } else {
                    loginError.style.display = 'block';
                    loginError.textContent = 'Invalid username or password. Use: admin/admin123.';
                }
            }
        });

        function isValidDateFormat(dateStr) {
            const regex = /^(0[1-9]|1[0-2])-[0-9]{4}$/;
            return regex.test(dateStr);
        }

        function parseDate(dateStr) {
            const [month, year] = dateStr.split('-').map(Number);
            return new Date(year, month - 1, 1);
        }

        function isExpiringSoon(expDateStr) {
            const today = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' });
            const todayDate = new Date(today);
            const expDate = parseDate(expDateStr);
            const timeDiff = expDate - todayDate;
            const daysDiff = timeDiff / (1000 * 60 * 60 * 24);
            return daysDiff <= 30 && daysDiff >= 0;
        }

        function displayMedicines(filteredMedicines = medicines) {
            if (!isLoggedIn) return;
            const tableBody = document.getElementById('medicineTable');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            filteredMedicines.forEach((medicine, index) => {
                const isExpiring = isExpiringSoon(medicine.expDate);
                const row = document.createElement('tr');
                if (isExpiring) row.classList.add('expired-row');
                row.innerHTML = `
                    <td>${medicine.productName || 'N/A'}</td>
                    <td>${medicine.quantity || 0}</td>
                    <td>${(medicine.mrp || 0).toFixed(2)}</td>
                    <td>${medicine.batchNo || 'N/A'}</td>
                    <td>${medicine.expDate || 'N/A'}</td>
                    <td>
                        <button class="btn btn-info btn-sm me-2" onclick="editMedicine(${index})"><i class="fas fa-edit me-2"></i>Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="removeMedicine(${index})"><i class="fas fa-trash me-2"></i>Remove</button>
                    </td>
                `;
                tableBody.appendChild(row);
                if (medicine.quantity === 0 && !wantingList.some(w => w.name === medicine.productName)) {
                    addWantingItem(medicine.productName, 0);
                }
            });
            updateNotificationMarquee();
        }

        function updateNotificationMarquee() {
            if (!isLoggedIn) return;
            const marquee = document.getElementById('notificationMarquee');
            if (!marquee) return;
            const expiringMedicines = medicines.filter(medicine => isExpiringSoon(medicine.expDate));
            if (expiringMedicines.length > 0) {
                marquee.textContent = expiringMedicines.map(m => `${m.productName || 'Unknown'} (Batch: ${m.batchNo || 'N/A'}) expires on ${m.expDate || 'N/A'}`).join(' | ');
            } else {
                marquee.textContent = 'No expiry products found!';
            }
            marquee.style.display = 'block';
        }

        function showExpiryAlert() {
            if (!isLoggedIn) return;
            const expiringMedicines = medicines.filter(medicine => isExpiringSoon(medicine.expDate));
            if (expiringMedicines.length > 0 && audioPlayed) {
                const alertSound = document.getElementById('alertSound');
                if (alertSound) {
                    try {
                        alertSound.play();
                    } catch (e) {
                        console.log('Audio play failed:', e);
                    }
                }
                const message = expiringMedicines.map(m => `${m.productName || 'Unknown'} (Batch: ${m.batchNo || 'N/A'}) expires on ${m.expDate || 'N/A'}`).join('\n');
                alert(`Expiring Soon:\n${message}`);
            }
        }

        function removeMedicine(index) {
            if (index >= 0 && index < medicines.length) {
                const medicineName = medicines[index].productName || 'Unknown';
                medicines.splice(index, 1);
                inMemoryMedicines = [...medicines];
                saveData();
                displayMedicines();
                showExpiryAlert();
                alert(`${medicineName} Removed!`);
            }
        }

        function editMedicine(index) {
            if (index >= 0 && index < medicines.length) {
                const medicine = medicines[index];
                document.getElementById('editIndex').value = index;
                document.getElementById('editProductName').value = medicine.productName || '';
                document.getElementById('editQuantity').value = medicine.quantity || 0;
                document.getElementById('editMrp').value = (medicine.mrp || 0).toFixed(2);
                document.getElementById('editBatchNo').value = medicine.batchNo || '';
                document.getElementById('editExpDate').value = medicine.expDate || '';

                const editModal = new bootstrap.Modal(document.getElementById('editModal'));
                if (editModal) editModal.show();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const editForm = document.getElementById('editForm');
            if (editForm) {
                editForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    if (!isLoggedIn) return;

                    const index = parseInt(document.getElementById('editIndex').value);
                    const productName = document.getElementById('editProductName').value.trim() || '';
                    const quantity = parseInt(document.getElementById('editQuantity').value) || 0;
                    const mrp = parseFloat(document.getElementById('editMrp').value) || 0;
                    const batchNo = document.getElementById('editBatchNo').value.trim().toUpperCase() || '';
                    const expDate = document.getElementById('editExpDate').value.trim() || '';

                    if (!productName || !batchNo || !isValidDateFormat(expDate)) {
                        alert('Please fill all fields with valid data (mm-yyyy format for Exp. Date).');
                        return;
                    }
                    if (quantity <= 0 || !Number.isInteger(quantity)) {
                        alert('Quantity must be a positive integer.');
                        return;
                    }
                    if (mrp < 0 || isNaN(mrp)) {
                        alert('MRP must be a non-negative number.');
                        return;
                    }
                    if (medicines.some((m, i) => m.batchNo === batchNo && i !== index)) {
                        alert('This batch number already exists. Please use a unique batch number.');
                        return;
                    }

                    medicines[index] = { productName, quantity, mrp, batchNo, expDate };
                    inMemoryMedicines = [...medicines];
                    saveData();
                    displayMedicines();
                    showExpiryAlert();
                    bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                    alert("Changes edited to the entry!");
                    this.reset();
                });
            }
        });

        function saveData() {
            try {
                localStorage.setItem('medicines', JSON.stringify(medicines));
                localStorage.setItem('wantingList', JSON.stringify(wantingList));
            } catch (e) {
                console.error('Error saving to localStorage:', e);
                medicines = [...inMemoryMedicines];
                wantingList = [...inMemoryWanting];
            }
        }

        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const clearSearch = document.getElementById('clearSearch');
            if (searchInput && clearSearch) {
                searchInput.addEventListener('input', () => {
                    if (searchTimeout) clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(searchMedicines, 300);
                    clearSearch.style.display = searchInput.value ? 'block' : 'none';
                });
                clearSearch.addEventListener('click', () => {
                    searchInput.value = '';
                    clearSearch.style.display = 'none';
                    displayMedicines();
                    resetScroll();
                });
                searchInput.addEventListener('change', resetScroll);
            }
        }

        function searchMedicines() {
            try {
                const searchInput = document.getElementById('searchInput')?.value.trim().toLowerCase() || '';
                if (searchInput.length < 2) {
                    displayMedicines();
                    return;
                }
                const filteredMedicines = medicines.filter(
                    medicine =>
                        (medicine.productName?.toLowerCase().includes(searchInput) || '') ||
                        (medicine.batchNo?.toLowerCase().includes(searchInput) || '')
                );
                displayMedicines(filteredMedicines);

                const searchResults = document.getElementById('searchResults');
                if (searchResults) {
                    searchResults.innerHTML = '';
                    if (filteredMedicines.length > 0) {
                        filteredMedicines.forEach(medicine => {
                            const isExpiring = isExpiringSoon(medicine.expDate);
                            const row = document.createElement('tr');
                            if (isExpiring) row.classList.add('expired-row');
                            row.innerHTML = `
                                <td>${medicine.productName || 'N/A'}</td>
                                <td>${medicine.quantity || 0}</td>
                                <td>${(medicine.mrp || 0).toFixed(2)}</td>
                                <td>${medicine.batchNo || 'N/A'}</td>
                                <td>${medicine.expDate || 'N/A'}</td>
                            `;
                            searchResults.appendChild(row);
                        });
                    } else {
                        searchResults.innerHTML = '<tr><td colspan="5">No matching medicines found.</td></tr>';
                    }
                    const searchModal = new bootstrap.Modal(document.getElementById('searchModal'), { backdrop: true });
                    if (searchModal) searchModal.show();
                }
            } catch (e) {
                console.error('Error in searchMedicines:', e);
            }
        }

        function resetScroll() {
            document.body.classList.remove('modal-open');
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) backdrop.remove();
            document.body.style.overflow = 'auto';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const searchModal = document.getElementById('searchModal');
            if (searchModal) searchModal.addEventListener('hidden.bs.modal', resetScroll);
            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.addEventListener('input', () => { if (!searchInput.value.trim()) resetScroll(); });
        });

        function generatePDF(isAuto = false) {
            if (!isLoggedIn) return;
            try {
                const doc = new jsPDF();
                doc.setFontSize(18);
                doc.text('Shivam Medical Hall - Expiry Report', 20, 20);
                doc.setFontSize(12);
                doc.text(`Generated on: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' })}`, 20, 30);
                if (isAuto) doc.text('Automatic Report (10:00 PM IST)', 20, 40);

                const expiringMedicines = medicines.filter(medicine => isExpiringSoon(medicine.expDate));
                let y = isAuto ? 50 : 40;
                doc.setFontSize(14);
                doc.text('Medicines Expiring Within 30 Days:', 20, y);
                y += 10;

                if (expiringMedicines.length === 0) {
                    doc.text('No medicines expiring within 30 days.', 20, y);
                } else {
                    doc.autoTable({
                        startY: y,
                        head: [['Product Name', 'Quantity', 'MRP (₹)', 'Batch No.', 'Exp. Date']],
                        body: expiringMedicines.map(m => [m.productName || 'N/A', m.quantity || 0, (m.mrp || 0).toFixed(2), m.batchNo || 'N/A', m.expDate || 'N/A']),
                        theme: 'striped',
                        styles: { fontSize: 10, cellPadding: 3 },
                        headStyles: { fillColor: [0, 123, 255] },
                        alternateRowStyles: { fillColor: [240, 240, 240] },
                        margin: { top: 10 }
                    });
                }
                doc.save(`Expiry_Report_${new Date().toISOString().split('T')[0]}_${isAuto ? 'Auto' : 'Manual'}.pdf`);
            } catch (e) {
                console.error('Error generating PDF:', e);
                alert('Failed to generate PDF. Please try again.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const medicineForm = document.getElementById('medicineForm');
            if (medicineForm) {
                medicineForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    if (!isLoggedIn) return;

                    const productName = document.getElementById('productName')?.value.trim() || '';
                    const quantity = parseInt(document.getElementById('quantity')?.value) || 0;
                    const mrp = parseFloat(document.getElementById('mrp')?.value) || 0;
                    const batchNo = document.getElementById('batchNo')?.value.trim().toUpperCase() || '';
                    const expDate = document.getElementById('expDate')?.value.trim() || '';

                    if (!productName || !batchNo || !isValidDateFormat(expDate)) {
                        alert('Please fill all fields with valid data (mm-yyyy format for Exp. Date).');
                        return;
                    }
                    if (quantity <= 0 || !Number.isInteger(quantity)) {
                        alert('Quantity must be a positive integer.');
                        return;
                    }
                    if (mrp < 0 || isNaN(mrp)) {
                        alert('MRP must be a non-negative number.');
                        return;
                    }
                    if (medicines.some(m => m.batchNo === batchNo)) {
                        alert('This batch number already exists. Please use a unique batch number.');
                        return;
                    }

                    const existingMedicine = medicines.find(m => m.productName.toLowerCase() === productName.toLowerCase() && m.batchNo === batchNo);
                    if (existingMedicine) {
                        if (existingMedicine.expDate !== expDate || Math.abs(existingMedicine.mrp - mrp) > 0.01) {
                            alert('Batch number exists with different Exp. Date or MRP. Please use a new batch number.');
                            return;
                        }
                        existingMedicine.quantity += quantity;
                    } else {
                        medicines.push({ productName, quantity, mrp, batchNo, expDate });
                    }

                    inMemoryMedicines = [...medicines];
                    saveData();
                    displayMedicines();
                    showExpiryAlert();
                    alert(`${productName} Added!`);
                    this.reset();
                });
            }
        });

        function initializeDatePickers() {
            const expPicker = new Pikaday({
                field: document.getElementById('expDate'),
                format: 'MM-YYYY',
                yearRange: [2000, new Date().getFullYear() + 10],
                minDate: new Date(),
                onSelect: function() {
                    document.getElementById('expDate').value = this.getMoment().format('MM-YYYY');
                }
            });
            document.getElementById('expDatePickerBtn').addEventListener('click', () => expPicker.show());

            const editExpPicker = new Pikaday({
                field: document.getElementById('editExpDate'),
                format: 'MM-YYYY',
                yearRange: [2000, new Date().getFullYear() + 10],
                minDate: new Date(),
                onSelect: function() {
                    document.getElementById('editExpDate').value = this.getMoment().format('MM-YYYY');
                }
            });
            document.getElementById('editExpDatePickerBtn').addEventListener('click', () => editExpPicker.show());
        }

        function exportData() {
            if (!isLoggedIn) return;
            const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(medicines));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute('href', dataStr);
            downloadAnchor.setAttribute('download', 'medicines_backup_' + new Date().toISOString().split('T')[0] + '.json');
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            document.body.removeChild(downloadAnchor);
        }

        function importData(event) {
            if (!isLoggedIn) return;
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedMedicines = JSON.parse(e.target.result);
                        if (Array.isArray(importedMedicines)) {
                            medicines = [...importedMedicines];
                            inMemoryMedicines = [...medicines];
                            saveData();
                            displayMedicines();
                            showExpiryAlert();
                            alert('Data imported successfully!');
                        } else {
                            alert('Invalid data format. Please use a valid medicines JSON file.');
                        }
                    } catch (e) {
                        console.error('Error importing data:', e);
                        alert('Failed to import data. Please check the file and try again.');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            }
        }

        function displayWanting() {
            if (!isLoggedIn) return;
            const tableBody = document.getElementById('wantingTable');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            if (wantingList.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3">No medicines left for wanting!</td></tr>';
            } else {
                wantingList.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.name || 'N/A'}</td>
                        <td>${item.qty || 0}</td>
                        <td>
                            <button class="btn btn-info btn-sm me-2" onclick="editWantingItem(${index})"><i class="fas fa-edit me-2"></i>Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="removeWantingItem(${index})"><i class="fas fa-trash me-2"></i>Remove</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        function addWantingItem(name = '', qty = 0) {
            if (!isLoggedIn) return;
            if (!name) {
                name = prompt('Enter Medicine Name')?.trim() || '';
                qty = parseInt(prompt('Enter Quantity') || 0) || 0;
            }
            if (name && qty > 0) {
                wantingList.push({ name, qty });
                inMemoryWanting = [...wantingList];
                saveData();
                displayWanting();
                if (!name.startsWith('Auto-')) alert(`${name} added to wanting list!`);
            } else if (name) {
                alert('Please enter a valid medicine name and quantity.');
            }
        }

        function editWantingItem(index) {
            if (index >= 0 && index < wantingList.length) {
                const item = wantingList[index];
                document.getElementById('editWantingIndex').value = index;
                document.getElementById('editWantingName').value = item.name || '';
                document.getElementById('editWantingQty').value = item.qty || 0;

                const editModal = new bootstrap.Modal(document.getElementById('editWantingModal'));
                if (editModal) editModal.show();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const editWantingForm = document.getElementById('editWantingForm');
            if (editWantingForm) {
                editWantingForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    if (!isLoggedIn) return;

                    const index = parseInt(document.getElementById('editWantingIndex').value);
                    const name = document.getElementById('editWantingName').value.trim() || '';
                    const qty = parseInt(document.getElementById('editWantingQty').value) || 0;

                    if (!name || qty <= 0 || !Number.isInteger(qty)) {
                        alert('Please enter a valid medicine name and quantity.');
                        return;
                    }

                    wantingList[index] = { name, qty };
                    inMemoryWanting = [...wantingList];
                    saveData();
                    displayWanting();
                    bootstrap.Modal.getInstance(document.getElementById('editWantingModal')).hide();
                    alert("Changes saved to wanting list!");
                    this.reset();
                });
            }

            const addWantingForm = document.getElementById('addWantingForm');
            if (addWantingForm) {
                addWantingForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    if (!isLoggedIn) return;

                    const name = document.getElementById('newWantingName').value.trim() || '';
                    const qty = parseInt(document.getElementById('newWantingQty').value) || 0;

                    if (!name || qty <= 0 || !Number.isInteger(qty)) {
                        alert('Please enter a valid medicine name and quantity.');
                        return;
                    }

                    addWantingItem(name, qty);
                    alert(`${name} is added successfully to Wanting List!`);
                    bootstrap.Modal.getInstance(document.getElementById('addWantingModal')).hide();
                    this.reset();
                });
            }
        });

        function removeWantingItem(index) {
            if (index >= 0 && index < wantingList.length) {
                const row = document.getElementById('wantingTable').children[index];
                if (row) {
                    row.classList.add('vanish');
                    setTimeout(() => {
                        wantingList.splice(index, 1);
                        inMemoryWanting = [...wantingList];
                        saveData();
                        displayWanting();
                    }, 500);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (isLoggedIn) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                const hamburgerMenu = document.getElementById('hamburgerMenu');
                if (hamburgerMenu) hamburgerMenu.style.display = 'block';
                displayMedicines();
                updateNotificationMarquee();
                showExpiryAlert();
                initializeSearch();
                initializeDatePickers();
            } else {
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
            }
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.body.setAttribute('data-theme', savedTheme);
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            } else {
                document.body.setAttribute('data-theme', 'light');
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) themeIcon.className = 'fas fa-moon';
            }
        });
    </script>
</body>
</html>